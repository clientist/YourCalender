<!DOCTYPE html>
<html>
  <%- include('./components/head'); -%>
  <script>
    $(document).ready(function() {

      function daysInMonth (month, year) {
        return new Date(year, month+1, 0).getDate();
      }

      const monthNames = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
      ];

      date = new Date();
      date.setDate(1);
      offset = date.getDay() + 1;
      console.log(date)
      console.log(offset)

      console.log(daysInMonth(date.getMonth()+1, date.getYear()))
      for (i = offset, x=1; i < daysInMonth(date.getMonth(), date.getYear()) + offset; i++, x++) {
        $('.day:nth-child(' + i + ')').prepend("<div class='calendarNumber'>" + x + "</div>")
      }

      //Dialog Popup
      $('.day').click(function(e) {
        $("#shadow").fadeIn(200,function() {
          //Pass target day information]
          
          $('#createTodo').append('');
          $('#createToDo').append('<input type="hidden" name="month" value="'+ date.getMonth() +'" />' + '<input type="hidden" name="day" value="'+ e.target.firstChild.textContent +'" />');

          $(document).keyup(function(e) {
              if (e.key === "Escape") { 
                $('#shadow').fadeOut(200)
              }
          });

          $('#exitMenu').click(function() {
            $('#shadow').fadeOut()
          })
        });
      })
      $('#createToDo').submit(function() {$('#shadow').fadeOut()})
    });
  </script>
  <body>
  <div id="shadow">
    <div id="toDoContainer">
    <div id="exitMenu"><img src="../images/exit.png"></div>
      <form id="createToDo" method="POST">
        <div class="title">What needs to get done?</div>
        <input type="text" name="todo" class="textInput">
      </form>
    </div>
    </div>
  </div>
  <div id="backgroundShade"></div>
  <div id="logo"><%

    function monthCycle(n) {
      if (n<0) {return 12-(n*-1)} else {return n % 12}
    }

    const monthNames = ["January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"]
    if (userMonth) { %>
     <%= monthNames[userMonth] %> <% } else { %> <%=monthNames[date.getMonth()] %> <%} %>
  </div>
  <div id="contentContainer">
    <% if (userMonth) { %>
      <a class="arrow" href="<%= '/mycalendar/' + (monthCycle(parseInt(userMonth)-1)) %> ">
    <% } else { %>
      <a class="arrow" href="<%= '/mycalendar/' + (monthCycle(date.getMonth()-1)) %> ">
    <% } %>
    <div class="arrow" id="leftArrow"></div>
    </a>
    <div id="mainContainer" style="width: calc(100% - 200px)">
        <div id="dayOfWeekContainer">
          <div class="weekDay">Sunday</div>
          <div class="weekDay">Monday</div>
          <div class="weekDay">Tuesday</div>
          <div class="weekDay">Wednesday</div>
          <div class="weekDay">Thursday</div>
          <div class="weekDay">Friday</div>
          <div class="weekDay">Saturday</div>
        </div>
        <div id="calendarContainer">
            <!--Render Tasks-->
            <%  
                if (userMonth != false) {month = calendar[userMonth]} else {month = calendar[date.getMonth()]}
                date = new Date();
                date.setDate(1);
                offset = date.getDay();
                for (i=0;i<35;i++) {
                    %> <div class='day'>
                      <div class="toDoItem"><% ;if(month.days[i-offset]) { %> 
                        <% for (j=0;j<month.days[i-offset].length;j++) { %>
                         <div><%= month.days[i-offset][j] %></div>
                        <% } %>
                      <% } %></div>
                    </div>
                <% } %>

        </div>
    </div>
    <% if (userMonth) { %>
      <a class="arrow" href="<%= '/mycalendar/' + (monthCycle(parseInt(userMonth)+1)) %> ">
    <% } else { %>
      <a class="arrow" href="<%= '/mycalendar/' + (monthCycle(date.getMonth()+1)) %> ">
    <% } %>
    <div class="arrow" id="rightArrow"></div>
    </a>
  </div>
    <div id="bottomRibbon">
      <a class="buttonLink" href="/logout"><div class="button">Logout</div></a>
      <div class="insetButton">View Help</div>
      <div class="bottomRibbonText" id="legal">&copy Gray Lewis 2019</div>
    </div>
  </body>
</html>